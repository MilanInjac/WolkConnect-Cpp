
\begin{DoxyCode}
1 ██╗    ██╗ ██████╗ ██╗     ██╗  ██╗ ██████╗ ██████╗ ███╗   ██╗███╗   ██╗███████╗ ██████╗████████╗
2 ██║    ██║██╔═══██╗██║     ██║ ██╔╝██╔════╝██╔═══██╗████╗  ██║████╗  ██║██╔════╝██╔════╝╚══██╔══╝
3 ██║ █╗ ██║██║   ██║██║     █████╔╝ ██║     ██║   ██║██╔██╗ ██║██╔██╗ ██║█████╗  ██║        ██║   
4 ██║███╗██║██║   ██║██║     ██╔═██╗ ██║     ██║   ██║██║╚██╗██║██║╚██╗██║██╔══╝  ██║        ██║   
5 ╚███╔███╔╝╚██████╔╝███████╗██║  ██╗╚██████╗╚██████╔╝██║ ╚████║██║ ╚████║███████╗╚██████╗   ██║   
6  ╚══╝╚══╝  ╚═════╝ ╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═══╝╚══════╝ ╚═════╝   ╚═╝   
7 
8                                                                           ██████╗██████╗ ██████╗ 
9                                                                          ██╔════╝██╔══██╗██╔══██╗
10                                                                    █████╗██║     ██████╔╝██████╔╝
11                                                                    ╚════╝██║     ██╔═══╝ ██╔═══╝ 
12                                                                          ╚██████╗██║     ██║     
13                                                                           ╚═════╝╚═╝     ╚═╝     
\end{DoxyCode}


 Wolk\+About C++11 Connector library for connecting devices to \href{https://demo.wolkabout.com/#/login}{\tt Wolk\+About IoT Platform}.

Supported protocol(s)\+:
\begin{DoxyItemize}
\item J\+S\+O\+N\+\_\+\+S\+I\+N\+G\+LE
\end{DoxyItemize}

\subsection*{Prerequisite }

Following tools/libraries are required in order to build Wolk\+About C++ connector


\begin{DoxyItemize}
\item cmake -\/ version 3.\+5 or later
\item autotools
\item autoconf
\item m4
\item zlib1g-\/dev
\end{DoxyItemize}

Former can be installed on Debian based system from terminal by invoking

{\ttfamily apt-\/get install autotools-\/dev autoconf m4 zlib1g-\/dev cmake}

Afterwards dependencies are built, and Makefile build system is generated by invoking {\ttfamily ./configure}

Generated build system is located inside \textquotesingle{}out\textquotesingle{} directory

Wolk\+About C++ Connector library, and example are built from \textquotesingle{}out\textquotesingle{} directory by invoking {\ttfamily make} in terminal

\subsection*{Example Usage }

Create a device on Wolk\+About IoT platform by importing manifest file {\ttfamily full-\/example-\/manifest.\+json} located in {\ttfamily examples/full\+\_\+feature\+\_\+set/} This manifest fits {\ttfamily full\+\_\+feature\+\_\+set} example and demonstrates all the functionality of Wolk\+Connect C++

{\bfseries Establishing connection with Wolk\+About IoT platform\+:} 
\begin{DoxyCode}
wolkabout::Device device(\textcolor{stringliteral}{"DEVICE\_KEY"}, \textcolor{stringliteral}{"DEVICE\_PASSWORD"}, \{\textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE"}, \textcolor{stringliteral}{"
      ACTUATOR\_REFERENCE\_TWO"}\});

std::unique\_ptr<wolkabout::Wolk> wolk =
  \hyperlink{classwolkabout_1_1Wolk_a91270bb8552c2dee634e552111db4bb0}{wolkabout::Wolk::newBuilder}(device)
    .\hyperlink{classwolkabout_1_1WolkBuilder_a5c8799ad21b6bb0f0c866af3295a69b7}{actuationHandler}([](\textcolor{keyword}{const} std::string& reference, \textcolor{keyword}{const} std::string& value) -> \textcolor{keywordtype}{void} \{
        \textcolor{comment}{// TODO Invoke your code which activates your actuator.}

        std::cout << \textcolor{stringliteral}{"Actuation request received - Reference: "} << reference << \textcolor{stringliteral}{" value: "} << value << 
      std::endl;
    \})
    .actuatorStatusProvider([](\textcolor{keyword}{const} std::string& reference) -> wolkabout::ActuatorStatus \{
        \textcolor{comment}{// TODO Invoke code which reads the state of the actuator.}

        \textcolor{keywordflow}{if} (reference == \textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE"}) \{
            \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{"65"}, wolkabout::ActuatorStatus::State::READY);
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (reference == \textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_TWO"}) \{
            \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{"false"}, wolkabout::ActuatorStatus::State::READY);
        \}

        \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{""}, wolkabout::ActuatorStatus::State::READY);
    \})
    .configurationHandler([](\textcolor{keyword}{const} std::map<std::string, std::string>& configuration) -> \textcolor{keywordtype}{void} \{
        \textcolor{comment}{// TODO invoke code which sets device configuration}
    \})
    .configurationProvider([]() -> \textcolor{keyword}{const} std::map<std::string, std::string>& \{
        \textcolor{comment}{// TODO invoke code which reads device configuration}
        \textcolor{keywordflow}{return} std::map<std::string, std::string>();
    \})
    .build();

    wolk->connect();
\end{DoxyCode}


{\bfseries Publishing sensor readings\+:} 
\begin{DoxyCode}
wolk->addSensorReading(\textcolor{stringliteral}{"TEMPERATURE\_REF"}, 23.4);
wolk->addSensorReading(\textcolor{stringliteral}{"BOOL\_SENSOR\_REF"}, \textcolor{keyword}{true});
\end{DoxyCode}


{\bfseries Publishing actuator statuses\+:} 
\begin{DoxyCode}
wolk->publishActuatorStatus(\textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE "});
\end{DoxyCode}
 This will invoke the Actuation\+Status\+Provider to read the actuator status, and publish actuator status.

{\bfseries Publish device configuration to platform\+:} 
\begin{DoxyCode}
wolk->publishConfiguration();
\end{DoxyCode}


{\bfseries Publishing events\+:} 
\begin{DoxyCode}
wolk->addAlarm(\textcolor{stringliteral}{"ALARM\_REF"}, \textcolor{keyword}{true});
\end{DoxyCode}


{\bfseries Data publish strategy\+:}

Sensor readings, and alarms are pushed to Wolk\+About IoT platform on demand by calling 
\begin{DoxyCode}
wolk->publish();
\end{DoxyCode}


Whereas actuator statuses are published automatically by calling\+:


\begin{DoxyCode}
wolk->publishActuatorStatus(\textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE "});
\end{DoxyCode}


{\bfseries Disconnecting from the platform\+:} 
\begin{DoxyCode}
wolk->disconnect();
\end{DoxyCode}


{\bfseries Data persistence\+:}

Wolk\+About C++ Connector provides mechanism for persisting data in situations where readings can not be sent to Wolk\+About IoT platform.

Persisted readings are sent to Wolk\+About IoT platform once connection is established. Data persistence mechanism used {\bfseries by default} stores data in-\/memory.

In cases when provided in-\/memory persistence is suboptimal, one can use custom persistence by implementing wolkabout\+::\+Persistence interface, and forwarding it to builder in following manner\+:


\begin{DoxyCode}
wolkabout::Device device(\textcolor{stringliteral}{"DEVICE\_KEY"}, \textcolor{stringliteral}{"DEVICE\_PASSWORD"}, \{\textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE"}, \textcolor{stringliteral}{"
      ACTUATOR\_REFERENCE\_TWO"}\});

std::unique\_ptr<wolkabout::Wolk> wolk =
  \hyperlink{classwolkabout_1_1Wolk_a91270bb8552c2dee634e552111db4bb0}{wolkabout::Wolk::newBuilder}(device)
    .\hyperlink{classwolkabout_1_1WolkBuilder_a5c8799ad21b6bb0f0c866af3295a69b7}{actuationHandler}([](\textcolor{keyword}{const} std::string& reference, \textcolor{keyword}{const} std::string& value) -> \textcolor{keywordtype}{void} \{
        std::cout << \textcolor{stringliteral}{"Actuation request received - Reference: "} << reference << \textcolor{stringliteral}{" value: "} << value << 
      std::endl;
    \})
    .actuatorStatusProvider([](\textcolor{keyword}{const} std::string& reference) -> wolkabout::ActuatorStatus \{
        \textcolor{keywordflow}{if} (reference == \textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE"}) \{
            \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{"65"}, wolkabout::ActuatorStatus::State::READY);
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (reference == \textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_TWO"}) \{
            \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{"false"}, wolkabout::ActuatorStatus::State::READY);
        \}

        \textcolor{keywordflow}{return} wolkabout::ActuatorStatus(\textcolor{stringliteral}{""}, wolkabout::ActuatorStatus::State::READY);
    \})
    .withPersistence(std::make\_shared<CustomPersistenceImpl>()) \textcolor{comment}{// Enable data persistance via custom
       persistence mechanism}
    .build();

    wolk->connect();
\end{DoxyCode}


For more info on persistence mechanism see wolkabout\+::\+Persistence and wolkabout\+::\+In\+Memory\+Persistence classes

{\bfseries Firmware Update\+:}

Wolk\+About c++ Connector provides mechanism for updating device firmware.

By default this feature is disabled. See code snippet below on how to enable device firmware update.


\begin{DoxyCode}
1 \{c++\}
2 
3 wolkabout::Device device("DEVICE\_KEY", "DEVICE\_PASSWORD", \{"ACTUATOR\_REFERENCE\_ONE",
       "ACTUATOR\_REFERENCE\_TWO"\});
4 
5 class CustomFirmwareInstaller: public wolkabout::FirmwareInstaller
6 \{
7 public:
8     bool install(const std::string& firmwareFile) override
9     \{
10         // Mock install
11         std::cout << "Updating firmware with file " << firmwareFile << std::endl;
12 
13         // Optionally delete 'firmwareFile
14         return true;
15     \}
16 \};
17 
18 auto installer = std::make\_shared<CustomFirmwareInstaller>();
19 
20 std::unique\_ptr<wolkabout::Wolk> wolk =
21   wolkabout::Wolk::newBuilder(device)
22     .actuationHandler([](const std::string& reference, const std::string& value) -> void \{
23         std::cout << "Actuation request received - Reference: " << reference << " value: " << value <<
       std::endl;
24     \})
25     .actuatorStatusProvider([](const std::string& reference) -> wolkabout::ActuatorStatus \{
26         if (reference == "ACTUATOR\_REFERENCE\_ONE") \{
27             return wolkabout::ActuatorStatus("65", wolkabout::ActuatorStatus::State::READY);
28         \} else if (reference == "ACTUATOR\_REFERENCE\_TWO") \{
29             return wolkabout::ActuatorStatus("false", wolkabout::ActuatorStatus::State::READY);
30         \}
31 
32         return wolkabout::ActuatorStatus("", wolkabout::ActuatorStatus::State::READY);
33     \})
34     .withPersistence(std::make\_shared<CustomPersistenceImpl>()) // Enable data persistance via custom
       persistence mechanism
35     // Enable firmware update
36     .withFirmwareUpdate("2.1.0",                                // Current firmware version
37                         installer,                              // Implementation of FirmwareInstaller,
       which performs installation of obtained device firmware
38                         ".",                                    // Directory where downloaded device
       firmware files will be stored
39                         100 * 1024 * 1024,                      // Maximum acceptable size of firmware
       file, in bytes
40                         1024 * 1024,                            // Size of firmware file transfer chunk, in
       bytes
41                         urlDownloader)                          // Optional implementation of
       UrlFileDownloader for cases when one wants to download device firmware via given URL
42     .build();
43 
44     wolk->connect();
\end{DoxyCode}


{\bfseries Keep Alive Mechanism\+:}

Wolk\+About C++ Connector by default uses Keep Alive mechanism to notify Wolk\+About IoT Platform that device is still connected. Keep alive message is sent to Wolk\+About IoT Platform every 10 minutes.

To reduce network usage Keep Alive mechanism can be disabled in following manner\+:


\begin{DoxyCode}
wolkabout::Device device(\textcolor{stringliteral}{"DEVICE\_KEY"}, \textcolor{stringliteral}{"DEVICE\_PASSWORD"}, \{\textcolor{stringliteral}{"ACTUATOR\_REFERENCE\_ONE"}, \textcolor{stringliteral}{"
      ACTUATOR\_REFERENCE\_TWO"}\});

std::unique\_ptr<wolkabout::Wolk> wolk =
  \hyperlink{classwolkabout_1_1Wolk_a91270bb8552c2dee634e552111db4bb0}{wolkabout::Wolk::newBuilder}(device)
    \textcolor{comment}{// actuation handlers setup}
    .\hyperlink{classwolkabout_1_1WolkBuilder_a22893971f31f5dccb5dec0690324a038}{withoutKeepAlive}() \textcolor{comment}{// Disable Keep Alive mechanism}
    .\hyperlink{classwolkabout_1_1WolkBuilder_aad4c9b0c925a023cf670dc2fdc6631f3}{build}();

    wolk->connect();
\end{DoxyCode}
 